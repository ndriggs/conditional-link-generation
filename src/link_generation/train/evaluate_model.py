from stable_baselines3.common.env_util import make_vec_env
from stable_baselines3 import PPO
from link_generation.envs.sig_det_env import SigDetEnv
import numpy as np

model_name = "braid_sparse_9_0.75_braid_15_8_3_32"
model = PPO.load(f"src/link_generation/train/models/{model_name}")
seed_idx = 4 if model_name[0] == 'o' else 5
vec_env = make_vec_env("SigDetEnv-v0", n_envs=1, 
                       env_kwargs={'state_rep': model_name.split('_')[0],
                                   'reward_type': model_name.split('_')[1],
                                   'braid_index': int(model_name.split('_')[2]),
                                   'max_braid_length': 60,
                                   'w1': float(model_name.split('_')[3]),
                                   'seed': int(model_name.split('_')[seed_idx])})

obs = vec_env.reset()
while True:
    action, _states = model.predict(obs)
    obs, rewards, dones, info = vec_env.step(action)
    if dones[0] :
        print(np.abs(info[0]['signature']), np.log1p(info[0]['determinant']))
        print(info[0]['braid_word'])


# ohe sparse 0.1
# 23 0.0
# [4, -1, 3, 3, 5, 1, 5, 5, 5, 8, 5, 5, 5, 5, 5, 5, 5, 8, 8, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5]
# 25 0.0
# [7, -1, 3, 3, 5, 1, 5, 5, 5, 8, 5, 5, 5, 5, 8, 5, 5, 8, 8, 5, 8, 5, 5, 5, 5, 5, 5, 8, 8, 5, 5]
# 21 0.0
# [1, -1, -1, 3, 5, 1, 5, 5, 5, 8, 5, 5, 5, 5, 5, 5, 5, 8, 8, 5, 8, 5, 5, 5, 5, 5, 5, -3, 5]
# 24 0.0
# [3, -1, 5, 3, 5, 1, 5, 5, 5, 8, 5, 5, 5, 5, 8, 5, 5, 8, 8, 5, 8, 5, 5, 5, 5, 5, 5, 5, 5]
# 27 0.0
# [-6, -1, 3, 5, 5, 1, 5, 5, 5, 8, 5, 5, 5, 5, 5, 5, 5, 8, 8, 5, 8, 5, 5, 5, 5, 5, 5, 8, 8, 5, 5, 5, 5]
# 18 0.0
# [4, -1, 3, 3, 5, 1, 5, 5, 5, 8, 5, 5, 5, 5, 5, 5, 5, 8, 5, 8, 5, 5, 5, 5]
# 23 0.0
# [3, -1, 5, 3, 5, 1, 5, 5, 5, 8, 5, 5, 5, 5, 5, 5, 5, 8, 8, 5, 8, 5, 5, 5, 5, 5, 5, 5]
# 22 0.0
# [8, -1, 3, 3, 5, 1, 5, 5, 5, 8, 8, 5, 5, 5, 5, 5, 5, 5, 8, 5, 8, 5, 5, 5, 5, 5, 5]
# 21 0.0
# [6, -1, 3, 3, 5, 1, 5, 5, 5, 8, 8, 5, 5, 5, 5, 5, 5, 8, 8, 5, 5, 5, 5, 5, 5, 5, 5]
# 12 0.0
# [-7, -1, 5, 5, 5, 1, 5, 5, 5, 5, 8, 5, 5, 5, 8, 5, 5]
# 24 0.0
# [-7, -1, 5, 5, 5, 1, 5, 5, 5, 8, 5, 5, 5, 5, 5, 5, 5, 8, 8, 5, 8, 5, 5, 5, 5, 5, 5, 5, 5]
# 23 0.0
# [-8, -1, 3, 3, 5, 1, 5, 5, 5, 8, 5, 5, 5, 5, 5, 5, 5, 8, 8, 5, 5, 5, 5, 5, 5, 5, 5, 5, -3, 5, 5, 5]
# 22 0.0
# [-4, -1, 3, 3, 5, 1, 5, 5, 5, 8, 5, 5, 5, 5, 8, 5, 8, 8, 8, 5, 5, 5, 5, 5, 5, 5, 5, 5]
# 11 0.0
# [-5, -1, 5, 5, 5, 1, 5, 5, 8, 5, 5, 5, 5, 5, 5, 5, 5]
# 21 0.0
# [4, -1, 3, 5, 5, 1, 5, 5, 5, 8, 8, 5, 5, 5, 5, 5, 5, 8, 8, 5, 5, 5, 5, 5, 5, 5, 5]
# 21 0.0
# [2, -1, 3, 3, 5, 1, 5, 5, 5, 8, 5, 5, 5, 5, 5, 5, 5, 8, 8, 5, 5, 5, 5, 5, 5, 5, 5, -3, 5]
# 24 0.0
# [-5, -1, 5, 3, 5, 1, 5, 5, 5, 8, 5, 5, 5, 5, 5, 5, 5, 8, 8, 5, 5, 5, 5, 5, 5, 5, 5, 8, 8, 8, 5]
# 26 0.0
# [8, -1, 3, 3, 5, 1, 5, 5, 5, 8, 5, 5, 5, 5, 5, 5, 5, 8, 8, 5, 5, 5, 5, 5, 5, 5, 5, 8, 8, 5, 5]
# 24 0.0
# [3, -1, 5, 3, 5, 1, 5, 5, 5, 8, 5, 5, 5, 5, 5, 5, 5, 8, 8, 5, 8, 5, 5, 5, 5, 5, 5, 5, 5]
# 8 2.833213344056216
# [-2, -1, 3, 3, 5, 1, 5, 5, 8, 5, 5, 5, 5, 1, 5]
# 16 0.0
# [2, -1, 5, 3, 3, 1, 8, 5, 5, 8, 8, 5, 5, 5, 5, 5, 5, 8, 8, 8, 5, 5]
# 23 0.0
# [7, -1, 3, 3, 5, 1, 5, 5, 5, 8, 5, 5, 5, 5, 5, 5, 5, 8, 8, 5, 8, 5, 5, 5, 5, 5, 5, 5, 5]



# braid dense
# [ 4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4
#  -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4
#  -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4  0]
# [ 7 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4
#  -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4
#  -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4  0]
# [ 1 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4
#  -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4
#  -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4  0]
# [ 3 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4
#  -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4
#  -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 -4  0]
# or 
# [ 4 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7
#  -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7
#  -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7  0]
# [ 7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7
#  -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7
#  -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7  0]
# [ 1 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7
#  -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7
#  -7 -7 -7 -7 -7 -7 -7 -7 -7 -7 -7  0]

# braid sparse 0.25
# [4 3 2 2 7 7 2 1 1 1 2 2 1 1 1 1 1 1 1 1 2 1 2 1 2 2 2 2 2 2 1 2 2 2 2 1 2
#  1 2 1 1 2 2 2 2 2 2 2 2 0 0 0 0 0 0 0 0 0 0 0]
# [ 7  3  3  7  1  7  2  1  1  2  1  2  1  2  2  2  1  2  2  1  2  7  1  2
#   2  1  2  1  1  2  6  2  1  1  2  2  2  2  2  1 -7  1  2  6  0  0  0  0
#   0  0  0  0  0  0  0  0  0  0  0  0]
# [ 1  1  2  1  1  2  2  1  2  2  2  1  2  2  1  1  2  2  2  2  1  1  1  1
#  -4  8  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
#   0  0  0  0  0  0  0  0  0  0  0  0]
# [3 2 1 1 1 2 1 2 2 2 2 2 2 2 1 2 2 8 2 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
#  0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
# [-6  3  1  2  2  1  1  7  2  1  2  1  1  2  1  1  2  1  2  1  2  2  2  2
#   1  2  2  7  2  2  2  1  1  2  6  2  0  0  0  0  0  0  0  0  0  0  0  0
#   0  0  0  0  0  0  0  0  0  0  0  0]
# [4 1 2 2 2 1 2 7 7 7 7 1 7 8 2 2 1 1 1 2 2 1 2 2 1 1 1 1 2 2 1 0 0 0 0 0 0
#  0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
# [ 3  1  2  1  1  2  2  1  1  2 -2  1  1  2  2  1  2  2  2  2  2  1  2  2
#   2  2  1  2  1  1  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
#   0  0  0  0  0  0  0  0  0  0  0  0]
# [8 3 3 2 1 1 2 2 2 2 1 2 2 1 7 1 2 2 1 2 7 2 1 1 1 2 2 2 2 2 2 2 2 2 2 2 2
#  2 2 2 2 2 1 1 2 2 2 1 2 1 2 2 1 2 2 2 2 1 2 0]
# [6 3 3 2 2 2 1 1 2 2 1 1 2 2 1 1 2 2 2 4 1 1 2 2 2 2 2 2 2 2 2 0 0 0 0 0 0
#  0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
# [-7  3  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
#   0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
#   0  0  0  0  0  0  0  0  0  0  0  0]
# [-7  3  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
#   0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
#   0  0  0  0  0  0  0  0  0  0  0  0]
# [-8  1  2  1  2  2  2  1  4  3  2  7  1  2  2  2  2  1  2  2  2  2  1  2
#   2  2  2  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
#   0  0  0  0  0  0  0  0  0  0  0  0]
# [-4  3  2  1  1  1  2  2  1  1  2  2  2  1  1  1  1  2  2  2  2  1  2  2
#   1  2  2  2  2  1  2  2  2  2  1  2  2  2  2  1  2  2  0  0  0  0  0  0
#   0  0  0  0  0  0  0  0  0  0  0  0]

# or 
# 0.75
# 9 11.38834815038527
# [4, 3, -1, -1, -5, -1, -7, -7, -5, -1, -7, -2, -1, -2, -2, -3, 2, -2, 2, -3, -7, -2, 2, -7, -7, -7, 2, 2, -7, -7, 2, -7, 2, 2, 2, 2, -3, 2, -7, 2, 2, 2, 2, 2, -8, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2]
# 12 5.484796933490655
# [7, 3, -7, -7, -1, -4, -5, -5, -5, -7, -7, -7, -7, -1, -7, 2, -7, -7, -2, -2, -2, -8, 2, -3, -2, -3, -7, -7, -1, -8, -2, -3, -7, -7, -3, -7, 6, -7, 2, -7, -7, 2, 6, 2, -7, 2, 2, 2, 2, 2, 2, -7, -7, 2, 2, 2, 2, -7, 2, 2]
# 24 9.427143867544194
# [1, 3, -7, 3, -1, -1, -5, -5, -1, -7, -1, -1, -8, -7, -1, -1, -1, -1, -2, -7, -7, 2, 2, -1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2]
# 22 11.823383680611148
# [3, -7, 3, -1, -1, -5, 4, -1, -7, -7, -7, -5, -7, -8, -7, 2, -8, -2, 2, 6, -3, -2, 6, 2, 2, 2, 2, 2, -8, 2, 2, 6, 2, 2, 2, 2, 2, 2, 2, 2, -3, 2, -7, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2]
# 50 7.578656850594762
# [-6, 3, -7, -7, -5, -5, -1, -5, -7, -1, -1, -1, -7, -7, -7, -1, -1, -8, -7, -1, -1, -1, -7, -7, -8, -7, -7, -7, -8, -7, -7, -1, -7, -5, -1, -7, -7, -7, -7, -1, -7, -7, -7, -7, -7, -7, -7, -1, -7, -7, -7, -1, -5, -7, -1, -8, -1, -7, -1, -7]
# 16 9.474625866621567
# [4, 3, -1, -1, -7, -7, -3, -7, -7, -7, 2, -5, -5, -7, -1, -7, -7, -8, -2, -2, -2, 2, -7, -7, 2, -3, -7, -7, 6, -7, -5, -7, -7, -7, -5, -8, -8, -7, -7, -2, -1, -2, -2, -3, -2, 6, 2, 2, 2, 2, 2, -2, 2, 2, 2, 2, 2, -8, 2, 2]
# 23 12.084046244519975
# [3, -7, 3, -1, -1, 4, -5, -1, -7, -1, 4, -1, -5, 6, -7, 6, -5, -1, 6, -7, -4, 6, -5, -7, -2, -5, -3, -7, 6, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2]